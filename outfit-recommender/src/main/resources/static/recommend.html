<!doctype html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>코디 추천</title>
    <link rel="stylesheet" href="/css/styles.css" />
</head>
<body class="container">
<nav>
    <a href="/index.html">홈</a>
    <a href="/wardrobe.html">내 옷장</a>
    <a href="/recommend.html">코디 추천</a>
</nav>
<h1>코디 추천</h1>

<label>스타일 <input id="style" value="데이트룩"></label>
<label>계절
    <select id="season">
        <option>SPRING</option><option>SUMMER</option><option>AUTUMN</option><option>WINTER</option>
    </select>
</label>
<button id="runBtn">추천 받기</button>

<div id="results"></div>

<script type="module">
    import { api, requireAuth } from "/app.js";

    function itemName(x) {
        return x && typeof x === "object" && "name" in x ? x.name : x;
    }

    requireAuth();

    const styleEl = document.getElementById("style");
    const seasonEl = document.getElementById("season");
    const results = document.getElementById("results");
    const runBtn = document.getElementById("runBtn");

    if (runBtn && styleEl && seasonEl && results) {
        runBtn.addEventListener("click", async () => {
            const res = await api("/api/coordinates/recommend", {
                method: "POST",
                body: JSON.stringify({ style: styleEl.value, season: seasonEl.value })
            });
            const data = await res.json();
            const arr = Array.isArray(data) ? data : (typeof data === "string" ? JSON.parse(data) : data);

            results.innerHTML = (arr || []).map((o) => {
                const isDress = !!o.dress;
                const top = isDress ? "" : `<div>상의: ${itemName(o.top)}</div>`;
                const bottom = isDress ? "" : `<div>하의: ${itemName(o.bottom)}</div>`;
                const dress = isDress ? `<div>원피스: ${itemName(o.dress)}</div>` : "";
                const outer = o.outer ? `<div>아우터: ${itemName(o.outer)}</div>` : "";
                const shoes = `<div>신발: ${itemName(o.shoes)}</div>`;
                return `<div class="card">${dress}${top}${bottom}${outer}${shoes}</div>`;
            }).join("");
        });
    }
</script>
</body>
</html>
